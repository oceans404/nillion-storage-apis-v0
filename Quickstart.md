# Quickstart Guide

In this guide, we'll:

- Register an app to get an app_id
- Store a number and string secret in Nillion
- List our app's store IDs (locations of secrets)
- Retrieve our secrets using their store IDs

You can explore and test all API endpoints at https://nillion-storage-apis-v0.onrender.com/docs

## 0. Register Your App

Create an app to get an `app_id`. This will create a table to track the store IDs of any app secrets stored in Nillion.

```bash
curl -X POST https://nillion-storage-apis-v0.onrender.com/api/apps/register
```

The response will contain your `app_id` - save this for the next steps.

## 1. Check Your User ID

Check the deterministic user ID generated by your user seed using POST `/api/user`. This ID will be used to control permissions for storing and retrieving secrets.

## 2. Store First Secret

Store a number secret using POST `/api/apps/{app_id}/secrets`. The empty permissions arrays mean only the storing user has access.

## 3. Store Second Secret

Store a string/blob secret using the same endpoint but with a different secret name.

## 4. List Store IDs

Get all store IDs for your app using GET `/api/apps/{app_id}/store_ids` to find your secrets.

## 5. Retrieve Secrets

Get each secret's value using GET `/api/secret/retrieve/{store_id}` with the correct secret name and user seed.

## Try the Complete Flow

Open your browser console and run this snippet (replace `your_app_id` with the app_id from registering your app in step 0):

```javascript
// run `curl -X POST https://nillion-storage-apis-v0.onrender.com/api/apps/register` to get your app_id
const APP_ID = 'INSERT_YOUR_APP_ID_HERE';
const USER_SEED = 'user_123'; // your seed generates a deterministic nillion user id - check it in step 1
const API_BASE = 'https://nillion-storage-apis-v0.onrender.com';

async function runQuickstart() {
  try {
    // 1. Check your deterministic user ID
    console.log('Checking user ID generated by your seed...');
    const user = await fetch(`${API_BASE}/api/user`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        nillion_seed: USER_SEED,
      }),
    }).then((res) => res.json());
    console.log('Your User ID:', user.nillion_user_id);

    // 2. Store first secret (number)
    console.log('\nStoring first secret...');
    const storeResult1 = await fetch(`${API_BASE}/api/apps/${APP_ID}/secrets`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        secret: {
          nillion_seed: USER_SEED,
          secret_value: 16,
          secret_name: 'my_secret_number',
        },
        permissions: {
          retrieve: [],
          update: [],
          delete: [],
          compute: {},
        },
      }),
    }).then((res) => res.json());
    console.log('First secret stored at:', storeResult1);

    // 3. Store second secret (string/blob)
    console.log('\nStoring second secret...');
    const storeResult2 = await fetch(`${API_BASE}/api/apps/${APP_ID}/secrets`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        secret: {
          nillion_seed: USER_SEED,
          secret_value: 'gm!',
          secret_name: 'my_secret_blob',
        },
        permissions: {
          retrieve: [],
          update: [],
          delete: [],
          compute: {},
        },
      }),
    }).then((res) => res.json());
    console.log('Second secret stored at:', storeResult2);

    // 4. List store IDs
    console.log('\nListing store IDs...');
    const storeIds = await fetch(`${API_BASE}/api/apps/${APP_ID}/store_ids`)
      .then((res) => res.json())
      .then((data) => data.store_ids);
    console.log('Store IDs:', storeIds);

    // 5. Retrieve both secrets using the store IDs we just created
    console.log('\nRetrieving secrets...');
    const secret1 = await fetch(
      `${API_BASE}/api/secret/retrieve/${storeIds[0].store_id}?retrieve_as_nillion_user_seed=${USER_SEED}&secret_name=${storeIds[0].secret_name}`
    ).then((res) => res.json());
    console.log('First secret retrieved:', secret1);

    const secret2 = await fetch(
      `${API_BASE}/api/secret/retrieve/${storeIds[1].store_id}?retrieve_as_nillion_user_seed=${USER_SEED}&secret_name=${storeIds[1].secret_name}`
    ).then((res) => res.json());
    console.log('Second secret retrieved:', secret2);
  } catch (error) {
    console.error('Error in flow:', error);
  }
}

// Run the quickstart
runQuickstart();
```

## Next Steps

- Try out the interactive API documentation at https://nillion-storage-apis-v0.onrender.com/docs
- Store a secret and give another user_id retrieve permission to the secret
  - First get your friend's user_id from them (their user seed is private - never share seeds!)
  - Then include their user_id in the permissions arrays when storing secrets

### Store a secret and give another user retrieve permission

```javascript
// Example using a test user_id - your friend should use their own unique seed in production
const friend_user_id =
  '63P5NjU6a2zkjJqengfuDuwMUF9Yu3ogrrqMPNjidc4ogfcvefDchZgRNNJQg9T3WKiyZ4L7kF4zGwFurpxCo5bP'; // seeded with 'test'

const storeResultForFriend = await fetch(
  `${API_BASE}/api/apps/${APP_ID}/secrets`,
  {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      secret: {
        nillion_seed: USER_SEED,
        secret_value: 'secret message to my friend!',
        secret_name: 'message_to_friend',
      },
      permissions: {
        retrieve: [friend_user_id], // give friend retrieve permission
        update: [],
        delete: [],
        compute: {},
      },
    }),
  }
).then((res) => res.json());
console.log('Secret stored:', storeResultForFriend);
```

### Retrieve a secret as another user

```javascript
// Replace with the store_id from storing the secret above
const store_id = 'REPLACE_WITH_THE_STORE_ID_ABOVE';
const secret_name = 'message_to_friend';
const friend_user_seed = 'test'; // use your own unique seed in production

const secret = await fetch(
  `${API_BASE}/api/secret/retrieve/${store_id}?retrieve_as_nillion_user_seed=${friend_user_seed}&secret_name=${secret_name}`
).then((res) => res.json());
console.log('Secret retrieved as friend:', secret);
```
